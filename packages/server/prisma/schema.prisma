// Transcendia Database Schema
// Semantic Key System: Metinler intent:context formatında saklanır

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Supported Languages
model Language {
  id          String   @id @default(cuid())
  code        String   @unique // e.g., "tr", "en", "de"
  name        String   // e.g., "Türkçe", "English"
  nativeName  String   // e.g., "Türkçe", "Deutsch"
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  translations Translation[]
  contributions Contribution[]

  @@index([code])
}

// Translation Keys with Semantic Context
model TranslationKey {
  id          String   @id @default(cuid())
  key         String   @unique // e.g., "intent:greeting+context:app_entry"
  intent      String   // e.g., "greeting"
  context     String   // e.g., "app_entry"
  description String?  // Human-readable description
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  translations Translation[]

  @@index([intent, context])
  @@index([key])
}

// Translations
model Translation {
  id              String   @id @default(cuid())
  keyId           String
  key             TranslationKey @relation(fields: [keyId], references: [id], onDelete: Cascade)
  languageId      String
  language        Language @relation(fields: [languageId], references: [id], onDelete: Cascade)
  value           String   // The translated text
  status          TranslationStatus @default(PENDING)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  contributions   Contribution[]

  @@unique([keyId, languageId])
  @@index([languageId])
  @@index([status])
}

enum TranslationStatus {
  PENDING
  APPROVED
  REJECTED
  ARCHIVED
}

// Community Contributions
model Contribution {
  id              String   @id @default(cuid())
  translationId   String?  @unique
  translation     Translation? @relation(fields: [translationId], references: [id], onDelete: SetNull)
  keyId           String
  key             TranslationKey @relation(fields: [keyId], references: [id], onDelete: Cascade)
  languageId      String
  language        Language @relation(fields: [languageId], references: [id], onDelete: Cascade)
  suggestedValue  String   // User's suggested translation
  comment         String?  // Optional explanation
  contributorId   String?  // User ID (if authenticated)
  status          ContributionStatus @default(OPEN)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([status])
  @@index([contributorId])
}

enum ContributionStatus {
  OPEN
  APPROVED
  REJECTED
  DUPLICATE
}

// Cache for frequently accessed translations
model TranslationCache {
  id          String   @id @default(cuid())
  key         String   @unique // composite key: "keyId:languageId"
  keyId       String
  languageId  String
  value       String
  expiresAt   DateTime
  createdAt   DateTime @default(now())

  @@index([expiresAt])
}
